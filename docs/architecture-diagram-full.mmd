graph TB
    User[ğŸ‘¤ User Browser]

    subgraph "Cloud Run Service"
        Frontend[ğŸŒ Frontend<br/>React/Vite UI]
        Backend[âš™ï¸ Backend API<br/>FastAPI + Gemini Pro]
    end

    subgraph "Google AI Studio"
        Gemini[ğŸ¤– Gemini Pro<br/>AI Analysis]
    end

    subgraph "Google Cloud Services"
        PubSub[ğŸ’¬ Pub/Sub<br/>Scan Requests]
        BigQuery[ğŸ—„ï¸ BigQuery<br/>Findings Storage]
        GCS[â˜ï¸ Cloud Storage<br/>Reports]
        Secrets[ğŸ” Secret Manager<br/>API Key Storage]
    end

    subgraph "Cloud Run Jobs"
        ScanJob[ğŸ“Š Scan Processor Job]
        ProposeJob[ğŸ“ Propose Job<br/>AI Report Gen]
    end

    %% Main flow
    User -->|"Web Request"| Frontend
    Frontend -->|REST API| Backend
    Backend -->|"Prompts"| Gemini
    Gemini -->|AI Responses| Backend
    
    %% Data flows
    Secrets -->|"API Key<br/>(auto-injected)"| Backend
    Secrets -->|"API Key<br/>(auto-injected)"| ProposeJob
    Backend -->|Publish| PubSub
    PubSub -->|Trigger| ScanJob
    ScanJob -->|Write| BigQuery
    Backend -->|Query| BigQuery
    Backend -->|Trigger| ProposeJob
    ProposeJob -->|Read| BigQuery
    ProposeJob -->|Prompts| Gemini
    ProposeJob -->|Upload| GCS
    
    %% Styling - Google Cloud colors
    classDef userStyle fill:#E3F2FD,stroke:#1976D2,stroke-width:3px
    classDef cloudRunStyle fill:#4285F4,stroke:#1A73E8,stroke-width:3px,color:#fff
    classDef aiStyle fill:#34A853,stroke:#188038,stroke-width:3px,color:#fff
    classDef secretStyle fill:#9C27B0,stroke:#7B1FA2,stroke-width:2px,color:#fff
    classDef dataStyle fill:#F4B400,stroke:#F57F17,stroke-width:2px
    classDef jobStyle fill:#EA4335,stroke:#C5221F,stroke-width:2px,color:#fff
    
    class User userStyle
    class Frontend,Backend cloudRunStyle
    class Gemini aiStyle
    class Secrets secretStyle
    class PubSub,BigQuery,GCS dataStyle
    class ScanJob,ProposeJob jobStyle

